<!DOCTYPE html><html><head>    <meta charset="utf-8">    <title>Plaster</title>        <meta name="description" content="Simple Mongoose-inspired schema based Javascript object modelling" />                <meta property="og:title" content=""/>    <meta property="og:type" content="website"/>    <meta property="og:image" content=""/>        <meta property="og:url" content=""/>        <script src="scripts/prettify/prettify.js"></script>    <script src="scripts/prettify/lang-css.js"></script>    <script src="scripts/jquery.min.js"></script>    <!--[if lt IE 9]>      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>    <![endif]-->    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">            <script>    var config = {"monospaceLinks":true,"cleverLinks":true,"default":{"outputSourceFiles":true},"applicationName":"Plaster","disqus":"","googleAnalytics":"","openGraph":{"title":"","type":"website","image":"","site_name":"","url":""},"meta":{"title":"Plaster","description":"Simple Mongoose-inspired schema based Javascript object modelling","keyword":""},"linenums":true};    </script>        </head><body><div id="wrap" class="clearfix">    <div class="navigation">    <h3 class="applicationName"><a href="index.html">Plaster</a></h3>    <div class="search">        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">    </div>    <ul class="list">            <li class="item" data-name="Model">            <span class="title">                <a href="Model.html">Model</a>                            </span>            <ul class="members itemMembers">                        <span class="subtitle">Members</span>                            <li data-name="Model#modelName"><a href="Model.html#modelName">modelName</a></li>                            <li data-name="Model#schema"><a href="Model.html#schema">schema</a></li>                        </ul>            <ul class="typedefs itemMembers">                        </ul>            <ul class="methods itemMembers">                        <span class="subtitle">Methods</span>                            <li data-name="Model#clear"><a href="Model.html#clear">clear</a></li>                            <li data-name="Model#clearErrors"><a href="Model.html#clearErrors">clearErrors</a></li>                            <li data-name="Model#getErrors"><a href="Model.html#getErrors">getErrors</a></li>                            <li data-name="Model#hasErrors"><a href="Model.html#hasErrors">hasErrors</a></li>                            <li data-name="Model#inspect"><a href="Model.html#inspect">inspect</a></li>                            <li data-name="Model#set"><a href="Model.html#set">set</a></li>                            <li data-name="Model#toJSON"><a href="Model.html#toJSON">toJSON</a></li>                            <li data-name="Model#toObject"><a href="Model.html#toObject">toObject</a></li>                            <li data-name="Model#toString"><a href="Model.html#toString">toString</a></li>                        </ul>            <ul class="events itemMembers">                        </ul>        </li>            <li class="item" data-name="ModelArray">            <span class="title">                <a href="ModelArray.html">ModelArray</a>                            </span>            <ul class="members itemMembers">                        </ul>            <ul class="typedefs itemMembers">                        </ul>            <ul class="methods itemMembers">                        </ul>            <ul class="events itemMembers">                        </ul>        </li>            <li class="item" data-name="ModelInstance">            <span class="title">                <a href="ModelInstance.html">ModelInstance</a>                            </span>            <ul class="members itemMembers">                        <span class="subtitle">Members</span>                            <li data-name="ModelInstance.modelName"><a href="ModelInstance.html#.modelName">modelName</a></li>                            <li data-name="ModelInstance.schema"><a href="ModelInstance.html#.schema">schema</a></li>                            <li data-name="ModelInstance#modelName"><a href="ModelInstance.html#modelName">modelName</a></li>                            <li data-name="ModelInstance#schema"><a href="ModelInstance.html#schema">schema</a></li>                        </ul>            <ul class="typedefs itemMembers">                        </ul>            <ul class="methods itemMembers">                        <span class="subtitle">Methods</span>                            <li data-name="ModelInstance#clear"><a href="ModelInstance.html#clear">clear</a></li>                            <li data-name="ModelInstance#clearErrors"><a href="ModelInstance.html#clearErrors">clearErrors</a></li>                            <li data-name="ModelInstance#getErrors"><a href="ModelInstance.html#getErrors">getErrors</a></li>                            <li data-name="ModelInstance#hasErrors"><a href="ModelInstance.html#hasErrors">hasErrors</a></li>                            <li data-name="ModelInstance#inspect"><a href="ModelInstance.html#inspect">inspect</a></li>                            <li data-name="ModelInstance#set"><a href="ModelInstance.html#set">set</a></li>                            <li data-name="ModelInstance#toJSON"><a href="ModelInstance.html#toJSON">toJSON</a></li>                            <li data-name="ModelInstance#toObject"><a href="ModelInstance.html#toObject">toObject</a></li>                            <li data-name="ModelInstance#toString"><a href="ModelInstance.html#toString">toString</a></li>                        </ul>            <ul class="events itemMembers">                        </ul>        </li>            <li class="item" data-name="Plaster">            <span class="title">                <a href="Plaster.html">Plaster</a>                            </span>            <ul class="members itemMembers">                        <span class="subtitle">Members</span>                            <li data-name="Plaster#Model"><a href="Plaster.html#Model">Model</a></li>                            <li data-name="Plaster#ModelArray"><a href="Plaster.html#ModelArray">ModelArray</a></li>                            <li data-name="Plaster#Plaster"><a href="Plaster.html#Plaster">Plaster</a></li>                            <li data-name="Plaster#Schema"><a href="Plaster.html#Schema">Schema</a></li>                        </ul>            <ul class="typedefs itemMembers">                        </ul>            <ul class="methods itemMembers">                        <span class="subtitle">Methods</span>                            <li data-name="Plaster#get"><a href="Plaster.html#get">get</a></li>                            <li data-name="Plaster#getModel"><a href="Plaster.html#getModel">getModel</a></li>                            <li data-name="Plaster#model"><a href="Plaster.html#model">model</a></li>                            <li data-name="Plaster#modelNames"><a href="Plaster.html#modelNames">modelNames</a></li>                            <li data-name="Plaster#schema"><a href="Plaster.html#schema">schema</a></li>                            <li data-name="Plaster#set"><a href="Plaster.html#set">set</a></li>                        </ul>            <ul class="events itemMembers">                        </ul>        </li>            <li class="item" data-name="Schema">            <span class="title">                <a href="Schema.html">Schema</a>                            </span>            <ul class="members itemMembers">                        </ul>            <ul class="typedefs itemMembers">                        </ul>            <ul class="methods itemMembers">                        <span class="subtitle">Methods</span>                            <li data-name="Schema#add"><a href="Schema.html#add">add</a></li>                            <li data-name="Schema#extend"><a href="Schema.html#extend">extend</a></li>                            <li data-name="Schema#get"><a href="Schema.html#get">get</a></li>                            <li data-name="Schema#method"><a href="Schema.html#method">method</a></li>                            <li data-name="Schema#post"><a href="Schema.html#post">post</a></li>                            <li data-name="Schema#pre"><a href="Schema.html#pre">pre</a></li>                            <li data-name="Schema#queue"><a href="Schema.html#queue">queue</a></li>                            <li data-name="Schema#set"><a href="Schema.html#set">set</a></li>                            <li data-name="Schema#static"><a href="Schema.html#static">static</a></li>                            <li data-name="Schema#virtual"><a href="Schema.html#virtual">virtual</a></li>                        </ul>            <ul class="events itemMembers">                        </ul>        </li>        </ul></div>    <div class="main">        <h1 class="page-title" data-filename="index.html">Index</h1>                <h3> </h3>        <section>        <article class="readme"><h1>Plaster</h1><p>Simple Mongoose-inspired schema based Javascript object modelling</p><p><strong>NodeJS &gt;= 0.12 supported. For all features, run node with the harmony proxies <code>--harmony_proxies</code> and harmony collections <code>--harmony</code> flags.</strong></p><h2>Installation</h2><p><code>npm install plaster</code></p><h2>Overview</h2><p>Plaster is a simple, Mongoose-inspired schema based Javascript object modelling library. Just define your schemas and<br>create Javascript classes from them.</p><pre class="prettyprint source lang-js"><code>var plaster = require('plaster');var schema = plaster.schema({ name: String });var Cat = plaster.model('Cat', schema);var kitty = new Cat({ name: 'Zildjian' });console.log(kitty);</code></pre><h4>Features:</h4><ul><li>Schema definition</li><li>Strict modelling based on schema</li><li>Schema extension</li><li>Automatic type validation and custom validation</li><li>Middleware including pre and post hooks</li></ul><h2>Guide</h2><ul><li><a href="#model">Modelling</a></li><li><a href="#middleware">Middleware</a></li><li><a href="#types">Types</a></li><li><a href="#extend">Schema Extending</a></li><li><a href="#errors">Errors</a></li></ul><h2>Modelling <a id="model"></a></h2><p><strong>Basics</strong></p><p>We begin defining a data model using a schema.</p><pre class="prettyprint source lang-js"><code>var userSchema = plaster.schema({  firstName: String,  lastName: String,  age: Number,  usernames: [String],  setup: Boolean  metadata: {    createdAt: Date,    updatedAt: Date  }});</code></pre><p>We can add additional properties using <code>add</code> function:</p><pre class="prettyprint source lang-js"><code>userSchema.add('name', String);</code></pre><p>Alternatively we can explicitly specify the type using <code>type</code> property:</p><pre class="prettyprint source lang-js"><code>var catSchema = plaster.schema({  name: { type: String }  breed: String,});catSchema.add('age', {type: String});</code></pre><p>Schema options can be set at construction or using the <code>set</code> function.</p><pre class="prettyprint source lang-js"><code>var catSchema = plaster.schema({  name: { type: String }  breed: String,});catSchema.set('minimize', false);</code></pre><p><strong>Validation</strong></p><p>Plaster does automatic validation against input data using the type information specified in the schema definition.<br>We can provide custom validation in schema definition by providing <code>validator</code> function.</p><pre class="prettyprint source lang-js"><code>var validator = require('validator'); // Node validator modulevar userSchema = plaster.schema({  name: String  email: {type: String, validate: validator.isEmail}});var User = plaster.model('User', userSchema);var user = new User({ name: 'Bob Smith' });user.email = 'bob@gmail.com'; // OKuser.email = 'bsmith'; // Nopeconsole.log(user.email); // 'bob@gmail.com'</code></pre><p><strong>Virtuals</strong></p><p>Virtuals are document properties that you can get and set but that do not get persisted to the database.<br>The getters are useful for formatting or combining fields, while setters are useful for de-composing a single value<br>into multiple values for storage.</p><pre class="prettyprint source lang-js"><code>var userSchema = plaster.schema({  firstName: String,   lastName: String});userSchema.virtual('fullName', {  get: function () {    return this.firstName + ' ' + this.lastName;  },  set: function (v) {    if (v !== undefined) {      var parts = v.split(' ');      this.firstName = parts[0];      this.lastName = parts[1];    }  }});var User = plaster.model('User', userSchema);var user = new User({firstName: 'Bob', lastName: 'Smith'});console.log(user.fullName); // Bob Smithuser.fullName = 'Jim Jones';console.log(user.fullName); // Jim Jonesconsole.log(user.firstName); // Jimconsole.log(user.lastName); // Jones</code></pre><p>If no <code>set</code> function is defined the virtual is read-only.</p><p><strong>Statics</strong></p><p>Adding static methods to Models can be accomplished using <code>static()</code> schema function</p><pre class="prettyprint source lang-js"><code>var userSchema = plaster.schema({  firstName: String,   lastName: String});userSchema.static('foo', function(p, q) {  return p + q;});var User = plaster.model('User', userSchema);User.foo(1, 2); // 3</code></pre><p>We can also pass an object of function keys and function values, and they will all be added.</p><p><strong>Methods</strong></p><p>Similarly adding instance methods to Models can be done using <code>method()</code> schema function. </p><pre class="prettyprint source lang-js"><code>var userSchema = plaster.schema({  firstName: String,   lastName: String});userSchema.method('fullName', function() {  return this.firstName + ' ' + this.lastName;});var User = plaster.model('User', userSchema);var user = new User({firstName: 'Bob', lastName: 'Smith'});user.fullName(); // 'Bob Smith'</code></pre><p>We can also pass an object of function keys and function values, and they will all be added.</p><p><strong>init() method</strong></p><p>There is a special <code>init</code> method that if specified in schema definition will be called at the end of model creation.<br>You can do additional setup here. This method is not passed in any arguments.</p><p><strong>toObject()</strong></p><p>Model instances come with <code>toObject</code> function that is automatically used for <code>console.log</code> inspection. </p><p>Options:</p><ul><li><code>transform</code> - function used to transform an object once it's been converted to plain javascript representation from a<br>model instance.</li><li><code>minimize</code> - to &quot;minimize&quot; the document by removing any empty properties. Default: <code>true</code></li><li><code>virtuals</code> - to apply virtual getters</li></ul><p>These settings can be applied on any invocation of <code>toObject</code> as well they can be set at schema level.</p><pre class="prettyprint source lang-js"><code>var userSchema = plaster.schema({  name: String,  email: String,  password: String});var xform = function (doc, ret, options) {  delete ret.password;  return ret;};userSchema.set('toObject', {transform: xform});var User = plaster.model('User', userSchema);var user = new User({  name: 'Joe',  email: 'joe@gmail.com',  password: 'password'});console.log(user); // { name: 'Joe', email: 'joe@gmail.com' }</code></pre><p><strong>toJSON()</strong></p><p>Similar to <code>toObject</code>. The return value of this method is used in calls to <code>JSON.stringify</code>.</p><h2>Middleware <a id="middleware"></a></h2><p>Similar to Mongoose middleware, we exposes <code>pre</code> and <code>post</code> <a target="_blank" href="https://www.npmjs.com/package/hooks-fixed">hooks</a>.</p><p><strong>onBeforeValueSet(key, value) / onValueSet(key, value)</strong></p><p><code>onBeforeValueSet</code> / <code>onValueSet</code> allow you to bind an event handler to all write operations on an object.<br>Currently, it will only notify of write operations on the object itself and will not notify you when child objects are<br>written to. If you return false or throw an error within the onBeforeValueSet handler, the write operation will be<br>cancelled. Throwing an error will add the error to the error stack.</p><pre class="prettyprint source lang-js"><code>var User = plaster.schema({ name: String }, {  onBeforeValueSet: function(key, value) {    if(key === 'name' && value.indexOf('Joe') >= 0) {      return false;    });  }});var User = plaster.model('User', schema);var user = new User();user.name = 'Bill'; // { name: undefined }user.name = 'Joe Smith'; //  { name: 'Joe Smith' }</code></pre><h2>Types <a id="types"></a></h2><p>Supported types:</p><ul><li>String</li><li>Number</li><li>Boolean</li><li>Date</li><li>Array (including types within Array)</li><li>Object (including typed Models for sub-schemas)</li><li>'any'</li></ul><p>When a type is specified, it will be enforced. Typecasting is enforced on all types except 'any'. If a value cannot be typecasted to the correct type, the original value will remain untouched.</p><p>Types can be extended with a variety of attributes. Some attributes are type-specific and some apply to all types.</p><p>Custom types can be created by defining an object with type properties.</p><pre class="prettyprint source lang-js"><code>var NotEmptyString = {type: String, minLength: 1};country: {type: NotEmptyString, default: 'USA'}</code></pre><h4>General attributes</h4><p><strong>transform</strong><br>Called immediately when value is set and before any typecast is done.</p><pre class="prettyprint source lang-js"><code>name: {type: String, transform: function(value) {  // Modify the value here...  return value;}}</code></pre><p><strong>validate</strong><br>Called immediately when value is set and before any typecast is done. Can be used for validating input data.<br>If you return <code>false</code> the write operation will be cancelled.</p><pre class="prettyprint source lang-js"><code>name: {type: String, validate: function(value) {  // check  return value;}}</code></pre><p><strong>default</strong><br>Provide default value. You may pass value directly or pass a function which will be executed when the object is initialized. The function is executed in the context of the object and can use &quot;this&quot; to access other properties (which .</p><pre class="prettyprint source lang-js"><code>country: {type: String, default: 'USA'}</code></pre><p><strong>get</strong><br>Provide function to transform value when retrieved. Executed in the context of the object and can use &quot;this&quot; to access properties.</p><pre class="prettyprint source lang-js"><code>string: {type: String, getter: function(value) { return value.toUpperCase(); }}</code></pre><p><strong>readOnly</strong><br>If true, the value can be read but cannot be written to. This can be useful for creating fields that reflect other values.</p><pre class="prettyprint source lang-js"><code>fullName: {type: String, readOnly: true, default: function(value) {  return (this.firstName + ' ' + this.lastName).trim();}}</code></pre><p><strong>invisible</strong><br>If true, the value can be written to but isn't outputted as an index when <code>toObject()</code> is called.<br>This can be useful for hiding internal variables.</p><h4>String</h4><p><strong>stringTransform</strong><br>Called after value is typecast to string <strong>if</strong> value was successfully typecast but called before all validation.</p><pre class="prettyprint source lang-js"><code>postalCode: {type: String, stringTransform: function(string) {  // Type will ALWAYS be String, so using string prototype is OK.  return string.toUpperCase();}}</code></pre><p><strong>regex</strong><br>Validates string against Regular Expression. If string doesn't match, it's rejected.</p><pre class="prettyprint source lang-js"><code>memberCode: {type: String, regex: new RegExp('^([0-9A-Z]{4})$')}</code></pre><p><strong>enum</strong><br>Validates string against array of strings. If not present, it's rejected.</p><pre class="prettyprint source lang-js"><code>gender: {type: String, enum: ['m', 'f']}</code></pre><p><strong>minLength</strong><br>Enforces minimum string length.</p><pre class="prettyprint source lang-js"><code>notEmpty: {type: String, minLength: 1}</code></pre><p><strong>maxLength</strong><br>Enforces maximum string length.</p><pre class="prettyprint source lang-js"><code>stateAbbrev: {type: String, maxLength: 2}</code></pre><p><strong>clip</strong><br>If true, clips string to maximum string length instead of rejecting string.</p><pre class="prettyprint source lang-js"><code>bio: {type: String, maxLength: 255, clip: true}</code></pre><h4>Number</h4><p><strong>min</strong><br>Number must be &gt; min attribute or it's rejected.</p><pre class="prettyprint source lang-js"><code>positive: {type: Number, min: 0}</code></pre><p><strong>max</strong><br>Number must be &lt; max attribute or it's rejected.</p><pre class="prettyprint source lang-js"><code>negative: {type: Number, max: 0}</code></pre><h4>Array</h4><p><strong>unique</strong><br>Ensures duplicate-free array, using === to test object equality.</p><pre class="prettyprint source lang-js"><code>emails: {type: Array, unique: true, arrayType: String}</code></pre><p><strong>arrayType</strong><br>Elements within the array will be typed to the attributes defined.</p><pre class="prettyprint source lang-js"><code>aliases: {type: Array, arrayType: {type: String, minLength: 1}}</code></pre><p>An alternative shorthand version is also available -- wrap the properties within array brackets.</p><pre class="prettyprint source lang-js"><code>aliases: [{type: String, minLength: 1}]</code></pre><h4>Object</h4><p><strong>objectType</strong><br>Allows you to define a typed object.</p><pre class="prettyprint source lang-js"><code>company: {type: Object, objectType: {  name: String}}</code></pre><p>An alternative shorthand version is also available -- simply pass a descriptor.</p><pre class="prettyprint source lang-js"><code>company: {  name: String}</code></pre><h4>Alias</h4><p><strong>index (required)</strong></p><p>The index key of the property being aliased.</p><pre class="prettyprint source lang-js"><code>zip: String,postalCode: {type: 'alias', index: 'zip'}// this.postalCode = 12345 -> this.toObject() -> {zip: '12345'}</code></pre><h2>Schema Extension <a id="extend"></a></h2><p>It is useful to have a common base schema, that all other schemas / models would extend or &quot;inherit&quot; properties from.<br>This can be accomplished by using the <code>Schema.extend</code> function. When used all properties, virtuals,<br>methods, statics, and middleware that are present in the base schema <strong>but not</strong> present in destination schema are copied<br>into the destination schema.</p><pre class="prettyprint source lang-js"><code> var baseSchema = plaster.schema({  metadata: {    doc_type: String,    createdAt: Date,    updatedAt: Date  }});baseSchema.method('save', function(fn) {  // simulate some async operation   var self = this;  process.nextTick(function() {    return fn(null, self);  });});baseSchema.pre('save', function (next) {  if (!this.metadata) {    this.metadata = {};  }  var now = new Date();  if (!this.metadata.createdAt) {    this.metadata.createdAt = now;  }  this.metadata.updatedAt = now;  this.metadata.doc_type = this.modelName;  next();});baseSchema.method('baseFoo', function () {  console.log('base foo');});var userSchema = plaster.schema({  name: String,  email: String,});userSchema.method('save', function(fn) {  // simulate some other async operation   var self = this;  process.nextTick(function() {    return fn(null, self);  });});userSchema.pre('save', function (next) {  if (this.email) {    this.email = this.email.toLowerCase();  }  next();});userSchema.method('userFoo', function () {  console.log('user foo');});// make user schema extend the base schema userSchema.extend(baseSchema);var User = plaster.model('User', userSchema);user = new User({  name: 'Bob Smith',  email: 'BSmith@gmail.com'});user.baseFoo() // prints 'base foo'user.userFoo() // prints 'user foo'user.save(function(err, savedDoc) {  console.log(user.metadata.updatedAt); // Sat Dec 29 2015 03:30:00 GMT-0400 (AST)  console.log(user.metadata.doc_type); // 'user'  console.log(user.email); // 'bsmith@gmail.com'});</code></pre><h2>Errors <a id="errors"></a></h2><p>When setting a value fails, an error is generated silently. Errors can be retrieved with <code>getErrors()</code> and cleared with <code>clearErrors()</code>.</p><pre class="prettyprint source lang-js"><code>var schema = new plaster.schema({  id: {type: String, minLength: 5}});var Profile = plaster.model('Profile', schema);var profile = new Profile();profile.id = '1234';console.log(profile.hasErrors()); // trueconsole.log(profile.getErrors());// Prints:[ { errorMessage: 'String length too short to meet minLength requirement.',    setValue: '1234',    originalValue: undefined,    fieldSchema: { name: 'id', type: 'string', minLength: 5 } } ]// Clear all errors.profile.clearErrors();</code></pre><h2>Tests</h2><p>Module automated tests can be run using <code>npm test</code> command.</p><h2>Credits</h2><p>Lots of code and design inspired by <a target="_blank" href="http://mongoosejs.com/">Mongoose</a>.<br>Uses modified code from <a target="_blank" href="https://github.com/scotthovestadt/node-schema-object">node-schema-object</a> for modelling.</p><h2>License</h2><p>Copyright 2016 Bojan D</p><p>Licensed under the MIT License.</p></article>    </section>                <footer>            Documentation generated by <a target="_blank" href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Thu Feb 11 2016 08:58:26 GMT-0400 (AST)        </footer>    </div></div><script>prettyPrint();</script><script src="scripts/linenumber.js"></script><script src="scripts/main.js"></script></body></html>